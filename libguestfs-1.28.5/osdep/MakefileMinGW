# Makefile for libguestfs-mingw-port: osdep

top_srcdir = ..
winport_dir = $(top_srcdir)/winport

CC = gcc -std=gnu99

CFLAGS = -DWINVER=0x0501 -I$(winport_dir)
WARN_CFLAGS = -Werror
LDFLAGS = 
LIBS = -lws2_32 -lwsock32

HEADERS = \
    os-error.h \
    os-fcntl.h \
    os-pipe.h \
    os-process.h \
    os-socket.h \
    os-socketpair.h

SOURCES = \
    os-fcntl.c \
    os-pipe.c \
    os-process.c \
    os-socket.c \
    os-socketpair.c

OBJECTS = $(SOURCES:.c=.o)

LIBRARY = osdep
LIBRARY_STATIC = lib$(LIBRARY).a
LIBRARY_DYNAMIC = $(LIBRARY).dll

all: $(LIBRARY_STATIC) $(LIBRARY_DYNAMIC)

$(LIBRARY_STATIC): $(OBJECTS)
	ar rcs -o $@ $^ 

$(LIBRARY_DYNAMIC): $(OBJECTS)
	$(CC) -shared -o $@ $^ $(LDFLAGS) $(LIBS)

%.o: %.c $(HEADERS)
	$(CC) -c $(CFLAGS) $(WARN_CFLAFS) -o $@ $<

clean:
	rm -rf *.o *~

.PHONY: all clean
