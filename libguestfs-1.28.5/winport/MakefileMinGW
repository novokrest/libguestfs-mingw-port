# Makefile for libguestfs-mingw-port: winport library

top_srcdir = ..

CC = gcc -std=gnu99

CFLAGS = -DWINVER=0x0501
WARN_CFLAGS = -Werror
LDFLAGS = 
LIBS = -lws2_32 -lwsock32

HEADERS = \
    win-port.h

SOURCES = \
    win-error.c \
    win-getuid.c \
    win-mem.c \
    win-realpath.c \
    win-strndup.c \
    win-symlink.c \
    win-vaprintf.c

OBJECTS = $(SOURCES:.c=.o)

LIBRARY = winport
LIBRARY_STATIC = lib$(LIBRARY).a
LIBRARY_DYNAMIC = $(LIBRARY).dll

all: $(LIBRARY_STATIC) $(LIBRARY_DYNAMIC)

$(LIBRARY_STATIC): $(OBJECTS)
	ar rcs -o $@ $^ 

$(LIBRARY_DYNAMIC): $(OBJECTS)
	$(CC) -shared -o $@ $^ $(LDFLAGS) $(LIBS)

%.o: %.c $(HEADERS)
	$(CC) -c $(CFLAGS) $(WARN_CFLAFS) -o $@ $<

clean:
	rm -rf *.o *~

.PHONY: all clean
