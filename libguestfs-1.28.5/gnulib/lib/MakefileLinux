# Makefile for libguestfs-mingw-port: gnulib

top_srcdir = ../..

CC = gcc -std=gnu99

WARN_CFLAGS = 
CFLAGS = -I. -Igthread -I$(top_srcdir)
LDFLAGS = 
LIBS = 

HEADERS = \
    allocator.h \
    areadlink.h \
    bitrotate.h \
    careadlinkat.h \
	cloexec.h \
	c-ctype.h \
	full-read.h \
	full-write.h \
	hash.h \
	hash-pjw.h \
	ignore-value.h \
	intprops.h \
	read-file.h \
	safe-read.h \
	safe-write.h \
	xalloc-oversized.h \
	xstrtol.h \
	glthread/lock.h

SOURCES = \
    allocator.c \
    areadlink.c \
    areadlinkat.c \
	bitrotate.c \
	careadlinkat.c \
	cloexec.c \
	c-ctype.c \
	full-read.c \
	full-write.c \
	hash.c \
	hash-pjw.c \
	read-file.c \
	safe-read.c \
	safe-write.c \
	xstrtol.c \
	xstrtoul.c \
	glthread/lock.c \
	glthread/threadlib.c

OBJECTS = $(SOURCES:.c=.o)

GNULIB = gnulib
GNULIB_STATIC = lib$(GNULIB).a
GNULIB_DYNAMIC = lib$(GNULIB).so

all: $(GNULIB_STATIC) $(GNULIB_DYNAMIC)

$(GNULIB_STATIC): $(OBJECTS)
	ar rcs -o $@ $^

$(GNULIB_DYNAMIC): $(OBJECTS)
	$(CC) -shared -o $@ $^ $(LD_FLAGS) $(LIBS)

%.o: %.c $(HEADERS)
	$(CC) -c $(WARN_CFLAGS) $(CFLAGS) -fPIC -o $@ $<

glthread/%.o: glthread/%.c
	$(CC) -c $(WARN_CFLAGS) $(CFLAGS) -fPIC -o $@ $<

clean:
	rm -f *.o glthread/*.o *~

.PHONY: all clean
